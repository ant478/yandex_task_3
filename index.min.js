function start(){var l=document.querySelector(".camera"),e=document.querySelector(".camera__video"),g=document.querySelector(".camera__canvas"),q=document.querySelector(".controls__fps"),G=document.querySelector(".controls__resolution"),z=document.querySelector(".controls__filter_container"),B=document.querySelector(".controls__filters_wrapper"),J=document.querySelector(".controls__filter_next"),u=document.querySelector(".controls__filter_previous"),n=document.querySelector(".controls__buttons"),s=document.querySelector(".controls__buttons_wrapper"),x=document.querySelector(".controls__buttons_play"),p=document.querySelector(".controls__buttons_pause"),I=g.getContext("2d"),A=null,i=null,a=0,c=0,F=0;index=0,pixels=[],filters=[{filter:E,name:"Без фильтра"},{filter:o,name:"Инвертировать"},{filter:d,name:"Черно-белый"},{filter:f,name:"Оттенки серого"},{filter:y,name:"Сепия"}];window.addEventListener("resize",t);J.addEventListener("click",D);u.addEventListener("click",m);x.addEventListener("click",r);p.addEventListener("click",b);window.requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(K){window.setTimeout(K,1000/60)}})();function H(K){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(navigator.getUserMedia){navigator.getUserMedia({video:true},function(L){e.onloadedmetadata=function(M){e.play();K()};e.src=window.URL.createObjectURL(L)},function(L){console.log("The following error occured: "+L.name)})}else{console.log("getUserMedia not supported")}}function E(){}function o(){for(index=0;index<pixels.length;index+=4){pixels[index]=255-pixels[index];pixels[index+1]=255-pixels[index+1];pixels[index+2]=255-pixels[index+2]}}function d(){for(index=0;index<pixels.length;index+=4){pixels[index]=pixels[index+1]=pixels[index+2]=(0.2126*pixels[index]+0.7152*pixels[index+1]+0.0722*pixels[index+2]>=128)?255:0}}function f(){for(index=0;index<pixels.length;index+=4){pixels[index]=pixels[index+1]=pixels[index+2]=0.2126*pixels[index]+0.7152*pixels[index+1]+0.0722*pixels[index+2]}}function y(){for(index=0;index<pixels.length;index+=4){pixels[index]=0.393*pixels[index]+0.769*pixels[index+1]+0.189*pixels[index+2];pixels[index+1]=0.349*pixels[index]+0.686*pixels[index+1]+0.168*pixels[index+2];pixels[index+2]=0.272*pixels[index]+0.534*pixels[index+1]+0.131*pixels[index+2]}}function h(){try{if(e.currentTime>0&&!e.paused&&!e.ended){a=g.width=l.offsetWidth;c=g.height=l.offsetHeight;I.drawImage(e,0,0,a,c);A=I.getImageData(0,0,a,c);pixels=A.data;i.filter();I.putImageData(A,0,0);F++}}finally{window.requestAnimFrame(h)}}function w(K){if(K>=0&&K<filters.length){i=filters[K];B.style.left=-K*z.offsetWidth+"px"}}function m(){w(filters.indexOf(i)-1)}function D(){w(filters.indexOf(i)+1)}function j(){q.textContent=F+" fps";F=0}function v(){G.textContent=a+"x"+c}function r(){e.play();s.style.left="0px"}function b(){e.pause();s.style.left=-n.offsetWidth+"px";F=0}function t(){a=g.width=l.offsetWidth;c=g.height=l.offsetHeight;v()}function k(){for(var L=0;L<filters.length;L++){var K=document.createElement("div");K.className="controls__filter";K.textContent=filters[L].name;B.appendChild(K)}}function C(){k();w(0);t();j();setInterval(j,1000);h()}H(C)}window.addEventListener("DOMContentLoaded",start);